# 2025年7月29日 タスクリスト

## プロジェクトレビューに基づく改善タスク

### 🎯 優先度: 高

#### 1. Mastraエージェントの実装
- [ ] 設計書に基づいた `NovelToMangaAgent` クラスの実装
- [ ] テキスト解析エージェントの作成
- [ ] 画像生成エージェントの作成
- [ ] レイアウト生成エージェントの作成
- [ ] weather関連のサンプルコードを削除

#### 2. 型安全性の向上
- [ ] Cloudflareバインディングの型定義ファイルを作成
  - [ ] `globalThis.NOVEL_STORAGE` (R2)の型定義
  - [ ] `globalThis.DB` (D1)の型定義
  - [ ] 環境変数の型定義
- [ ] `@cloudflare/workers-types` の設定確認

#### 3. .gitignoreの修正
- [ ] `.next` フォルダを追加
- [ ] `.local-storage` フォルダを追加
- [ ] その他の不要なビルド成果物を確認して追加

### 📋 優先度: 中

#### 4. 基本的なテストの実装
- [ ] `chunk-splitter` の単体テスト実装
- [ ] API エンドポイントの統合テスト実装
  - [ ] `/api/novel` のテスト
  - [ ] `/api/novel/storage` のテスト
  - [ ] `/api/novel/db` のテスト
- [ ] 型定義のテスト充実

#### 5. エラーハンドリングの統一
- [ ] `NovelToMangaError` クラスの実装
- [ ] エラーハンドリングミドルウェアの実装
- [ ] 各APIエンドポイントでの統一的なエラー処理

#### 6. データモデルの修正
- [ ] SQLiteスキーマに `title` フィールドを追加
- [ ] D1マイグレーションスクリプトの作成
- [ ] Novel型定義とDBスキーマの整合性確認

### 🔧 優先度: 低

#### 7. セキュリティの強化
- [ ] ファイルサイズ制限の実装（例: 10MB）
- [ ] 入力検証の強化（Zodスキーマの活用）
- [ ] CORS設定の実装
- [ ] レート制限の検討

#### 8. パフォーマンス最適化
- [ ] チャンク処理の並列化実装
- [ ] Cloudflare KVの活用（キャッシュ戦略）
- [ ] 大きなファイルのストリーミング処理

#### 9. 開発環境の整備
- [ ] ESLint設定ファイルの削除（Biomeに統一）
- [ ] package.jsonのバージョン整合性確認
  - [ ] Next.js 15.3.3 → 15.4.4へのアップデート検討
- [ ] CI/CDパイプラインの基本設定

#### 10. ドキュメントの確認と実装
- [ ] Mastraドキュメントの確認（`mcp__mastra__mastraDocs`使用）
- [ ] Cloudflareドキュメントの確認（`mcp__cloudflare__search_cloudflare_documentation`使用）
- [ ] OpenNextドキュメントの確認

## 実装順序の推奨

1. **まず.gitignoreを修正**（簡単で影響大）
2. **型定義の追加**（開発効率が向上）
3. **Mastraエージェントの基本実装**（コア機能）
4. **テストの実装**（品質保証）
5. **その他の改善**（段階的に実施）

## 注意事項

- 各タスクの実装前に、関連するドキュメント（Mastra、Cloudflare）を必ず確認すること
- 設計書（`.kiro/specs/novel-to-manga-converter/design.md`）を参照しながら実装すること
- コミットは機能単位で小さく区切ること