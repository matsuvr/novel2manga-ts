# 結果ページのリファクタリング記録

## 実施日: 2025-09-05

## 背景

2つの結果表示ページが存在していたが、役割が重複していた：

- `/novel/[novelId]/results/page.tsx` - ジョブIDなしの結果ページ
- `/novel/[novelId]/results/[jobId]/page.tsx` - ジョブID付きの結果ページ

## 調査結果

実際のコードを調査した結果：

- すべての画面遷移は`[jobId]`付きのページを使用していることが判明
- `HomeClient.tsx`と`ProgressPageClient.tsx`はどちらも`/novel/[novelId]/results/[jobId]`へ直接遷移
- ジョブIDなしのページは実質的に未使用

## 実施内容

1. **段階的削除アプローチ**を採用（安全性を重視）
2. `/novel/[novelId]/results/page.tsx`をリダイレクト専用ページに変更
   - 後方互換性のため、最新のジョブへ自動リダイレクトする仕様に
   - 廃止予定（deprecated）として明確にマーク
3. オリジナルコードは`_deprecated`ディレクトリにバックアップ

## 今後の予定

- **2025年10月頃**: 1ヶ月間の様子見期間後、問題がなければ完全削除
- それまでは後方互換性のためリダイレクト機能を維持

## DRY原則の遵守

- 重複した結果表示ロジックを排除
- すべての結果表示を`[jobId]`付きのページに統一
- メンテナンスコストの削減とコードの明確化を達成

## 影響範囲

- ユーザー影響: なし（リダイレクトにより透過的に処理）
- 開発影響: 結果ページのコードが1箇所に集約され、保守性が向上

## テスト

- 既存のE2Eテスト（`results-access.e2e.spec.ts`）は`[jobId]`付きのページをテストしているため影響なし
- リダイレクト機能は手動で確認済み
